import{a as ie}from"./chunk-ISP3C4HY.js";import{a as W,b as y,c as J,d as K,e as X,g as Y,j as Z,m as ee,o as te,p as ne}from"./chunk-JM7D3BYY.js";import{a as Q}from"./chunk-RUJGDCOP.js";import{$ as L,Ba as N,C as G,Da as H,Ea as q,G as h,Ga as I,H as _,Ha as U,I as O,Ia as $,K as w,L as M,M as v,N as a,O as o,P as s,Q as b,R as x,S as T,T as P,V as C,W as k,X as f,Y as z,Z as R,_ as j,ba as l,ca as F,da as B,n as u,o as g,ra as S,u as E,v as d,x as m,y as D,ya as A}from"./chunk-ZZRN4C6H.js";var de=["fileInput"],V=class r{constructor(t,e){this.cloudy=t;this.cdr=e}fileInput;progress=-1;imagePreview="";isHovering=!1;uploaded=new G;onFileChange(t){let e=t.target;if(e.files&&e.files.length>0){let n=e.files[0];this.upload(n)}}async onDrop(t,e){if(t.preventDefault(),this.isHovering=!1,t.dataTransfer?.files&&t.dataTransfer.files.length>0){let n=t.dataTransfer.files[0];this.upload(n),t.dataTransfer.clearData()}}onFilesSelected(t){this.fileInput.nativeElement.click()}upload(t){this.progress=0,this.cloudy.uploadFile(t).subscribe(e=>{if(e.type===A.UploadProgress&&e.total)this.progress=Math.round(e.loaded/e.total*100),this.cdr.detectChanges();else if(e.type===A.Response){console.log("\u2705 Subida completa:",e.body);let n=e.body,i=n.secure_url.replace("/upload/","/upload/q_auto,f_auto/");this.progress=100,this.imagePreview=i,this.uploaded.emit({secure_url:i,public_id:n.public_id}),setTimeout(()=>{this.progress=0,this.cdr.detectChanges()},3e3),this.cdr.detectChanges()}})}onDragOver(t,e){t.preventDefault(),this.isHovering=!0}onDragLeave(t){this.isHovering=!1}static \u0275fac=function(e){return new(e||r)(m(ie),m(S))};static \u0275cmp=D({type:r,selectors:[["app-drag-and-drop"]],viewQuery:function(e,n){if(e&1&&z(de,5),e&2){let i;R(i=j())&&(n.fileInput=i.first)}},outputs:{uploaded:"uploaded"},decls:13,vars:2,consts:[["fileInput",""],[1,"drag-n-drop-cont",3,"click","dragleave","dragover","drop"],[1,"dnd-icon"],["src","upload-cloud.svg","alt",""],["type","file","id","",2,"display","none",3,"change"],[1,"dnd-txt"],[1,"progress-bar"]],template:function(e,n){if(e&1){let i=P();b(0,"div",1),k("click",function(c){return u(i),g(n.onFilesSelected(c))})("dragleave",function(c){return u(i),g(n.onDragLeave(c))})("dragover",function(c){return u(i),g(n.onDragOver(c))})("drop",function(c){return u(i),g(n.onDrop(c))}),b(1,"div",2),T(2,"img",3),x(),b(3,"input",4,0),k("change",function(c){return u(i),g(n.onFileChange(c))}),x(),b(5,"div",5)(6,"p")(7,"span"),l(8,"Haga clic para cargar"),x(),l(9," o arrastrar y soltar"),x(),b(10,"p"),l(11,"SVG, PNG, JPG or GIF (max. 800x400px)"),x()(),T(12,"div",6),x()}e&2&&(d(12),L("width",n.progress,"%"))},styles:[".drag-n-drop-cont[_ngcontent-%COMP%]{display:flex;position:relative;padding:16px 24px;width:100%;flex:1;flex-direction:column;align-items:center;gap:4px;align-self:stretch;border-radius:8px;border:1px solid var(--Gray-200, #E9EAEB);background:var(--White, #FFF);box-sizing:border-box}.progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:0%;left:0;height:4px;background-color:var(--Brand-700, #007981);border-radius:0 0 8px 8px;transition:width .3s ease}.dnd-icon[_ngcontent-%COMP%]{display:flex;width:40px;height:40px;padding:10px;justify-content:center;align-items:center;border-radius:28px;box-sizing:border-box;border:6px solid var(--Gray-50, #FAFAFA);background:var(--Gray-100, #F5F5F5)}.dnd-txt[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--Gray-600, #535862);font-family:var(--montser-font);font-size:14px;font-style:normal;font-weight:400;line-height:20px;margin:0}.dnd-txt[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--Brand-700, #007981);font-weight:600}"]})};function le(r,t){r&1&&(a(0,"div",2),s(1,"app-box-loader"),o())}function se(r,t){if(r&1&&(a(0,"div",24),l(1),o()),r&2){let e=f(2);d(),B("-",e.calculateDiscount(e.selectedVariant)," %")}}function ce(r,t){if(r&1&&(a(0,"div",22),s(1,"img",23),o(),a(2,"label",6),l(3),o(),h(4,se,2,1,"div",24)),r&2){let e=f();d(),v("src",e.selectedVariant.image,E),d(2),F(e.selectedVariant.genericProd==null?null:e.selectedVariant.genericProd.name),d(),_(e.calculateDiscount(e.selectedVariant)?4:-1)}}function pe(r,t){r&1&&(a(0,"label",6),l(1,"Selecciona las productos para esta promoci\xF3n"),o())}function me(r,t){if(r&1&&(a(0,"span"),l(1),o(),a(2,"div",24),l(3),o()),r&2){let e=t.$implicit;d(),F(e.name),d(2),B("-",e.discount+" "+(e.discountType=="percent"?"%":"$")," ")}}function ue(r,t){r&1&&s(0,"img",30)}function ge(r,t){if(r&1){let e=P();a(0,"div",28),C("click",function(i){let p=u(e).$implicit,c=f(3);return i.stopPropagation(),g(c.slelectProd(p))}),a(1,"div",22),s(2,"img",23),o(),a(3,"div",29)(4,"p"),l(5),o(),w(6,me,4,2,null,null,O),o(),h(8,ue,1,0,"img",30),o()}if(r&2){let e=t.$implicit,n=f().$implicit,i=f(2);d(2),v("src",e.image,E),d(3),F(n.name),d(),M(i.filterActivePromotions(e.promotions)),d(2),_(e.id==(i.selectedVariant==null?null:i.selectedVariant.id)?8:-1)}}function fe(r,t){if(r&1&&w(0,ge,9,3,"div",25,O),r&2){let e=t.$implicit;M(e.variants)}}function he(r,t){if(r&1){let e=P();a(0,"div",15)(1,"div",25)(2,"div",13),C("click",function(i){return u(e),g(i.stopPropagation())}),s(3,"img",26)(4,"input",27,0),o()(),w(6,fe,2,0,null,null,O),o()}if(r&2){let e=f();d(6),M(e.filteredProd)}}function _e(r,t){if(r&1&&(a(0,"div",18),s(1,"img",23),o()),r&2){let e,n=f();d(),v("src",(e=n.editForm.get("image"))==null?null:e.value,E)}}var re=class r{constructor(t,e,n,i,p,c){this.router=t;this.route=e;this.fb=n;this.http=i;this.cdr=p;this.errorServ=c;this.editForm=n.group({name:["",y.required],description:["",y.required],search:[""],image:["",y.required],prodID:["",y.required],publicID:["",y.required]})}loadProd=!0;loadingBanner=!0;openProdOption=!1;editForm;currentBanner;filteredProd=[];selectedVariant;products=[];id=void 0;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");this.id=t?+t:void 0,this.editForm.get("search")?.valueChanges.subscribe(e=>{this.filteredProd=this.products.filter(n=>this.match(n.name,e))}),this.loadData()}onSubmit(){if(this.valid()&&this.currentBanner){this.loadingBanner=!0;let t={name:this.editForm.get("name")?.value,description:this.editForm.get("description")?.value,prodId:this.editForm.get("prodID")?.value,image:this.editForm.get("image")?.value,carouselId:this.currentBanner.carouselId,publicId:this.editForm.get("publicID")?.value};this.http.updateBanner(t,this.currentBanner.id).subscribe({next:e=>{this.loadingBanner=!1,this.router.navigate(["/dashboard/promotions"])},error:e=>this.errorServ.addError(I(e))})}}slelectProd(t){this.selectedVariant=t,this.editForm.get("prodID")?.setValue(t.id),this.openProdOption=!this.openProdOption}onUploaded(t){let e=t;this.editForm.get("image")?.setValue(e.secure_url),this.editForm.get("publicID")?.setValue(e.public_id),console.log(e)}onOpenSelProd(){this.openProdOption=!this.openProdOption}loadData(){this.loadProd=!0,this.loadBanner(),this.http.getProducts().subscribe({next:t=>{this.products=t,this.filteredProd=this.products,this.loadProd=!1,this.cdr.detectChanges()},error:t=>{this.loadProd=!1,this.cdr.detectChanges(),this.errorServ.addError(I(t))}})}loadBanner(){this.id&&(this.loadingBanner=!0,this.http.getBanner(this.id).subscribe({next:t=>{this.currentBanner=t,console.log(t),this.editForm.setValue({name:this.currentBanner.name,description:this.currentBanner.description,image:this.currentBanner.image,prodID:this.currentBanner.prodId,search:"",publicID:this.currentBanner.publicId}),this.selectedVariant=this.currentBanner.product,this.loadingBanner=!1,this.cdr.detectChanges()},error:t=>{this.errorServ.addError(I(t)),this.loadingBanner=!1}}))}valid(){return this.editForm.valid}match(t,e){return t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),t.match(e)}calculateDiscount(t){let e=t.promotions.filter(i=>i.promotion.discountType=="percent");return this.filterActivePromotions(e).map(i=>i.discount).reduce((i,p)=>i+p,0)}filterActivePromotions(t){let e=new Date;return t.filter(i=>new Date(i.promotion.endDate)>e&&new Date(i.promotion.startDate)<e).map(i=>i.promotion)}loading=()=>this.loadingBanner||this.loadProd;static \u0275fac=function(e){return new(e||r)(m(H),m(N),m(te),m(U),m(S),m($))};static \u0275cmp=D({type:r,selectors:[["app-edit-banner"]],decls:44,vars:8,consts:[["searchProd",""],[1,"main"],[1,"loader-wrapper"],[1,"header"],[1,"create-form",3,"submit","formGroup"],[1,"form-text"],["for",""],[1,"input-base"],["type","text","formControlName","name"],[1,"line"],[1,"input-container"],["type","text","formControlName","description","maxlength","500"],[1,"count"],[1,"input-base",3,"click"],["src","chevron-down.svg","alt",""],[1,"dialog","products"],[1,"image-container"],[2,"width","100%",3,"uploaded"],[1,"banner-prev"],[1,"form-footer"],["type","button",1,"button-chips",3,"routerLink"],["type","submit",1,"button-base",3,"disabled"],[1,"image"],["alt","",3,"src"],[1,"discount"],[1,"dialog-item"],["src","search.svg","alt",""],["type","text","formControlName","search","placeholder","Buscar"],[1,"dialog-item",3,"click"],[1,"data"],["src","check.svg","alt",""]],template:function(e,n){if(e&1&&(a(0,"div",1),h(1,le,2,0,"div",2),a(2,"header",3)(3,"h1"),l(4,"Promociones"),o()(),a(5,"form",4),C("submit",function(){return n.onSubmit()}),a(6,"div",5)(7,"label",6),l(8,"Nombre"),o(),a(9,"div",7),s(10,"input",8),o(),s(11,"div",9),o(),a(12,"div",5)(13,"label",6),l(14,"Descripci\xF3n breve"),o(),a(15,"div",10)(16,"div",7),s(17,"textarea",11),o(),a(18,"span",12),l(19),o()(),s(20,"div",9),o(),a(21,"div",5)(22,"label",6),l(23,"Productos"),o(),a(24,"div",13),C("click",function(){return n.onOpenSelProd()}),h(25,ce,5,3)(26,pe,2,0,"label",6),s(27,"img",14),h(28,he,8,0,"div",15),o(),s(29,"div",9),o(),a(30,"div",5)(31,"label",6),l(32,"Banner"),o(),a(33,"div",16)(34,"app-drag-and-drop",17),C("uploaded",function(p){return n.onUploaded(p.valueOf())}),o(),h(35,_e,2,1,"div",18),o(),s(36,"div",9),o(),a(37,"footer",19)(38,"button",20)(39,"span"),l(40,"Cancelar"),o()(),a(41,"button",21)(42,"span"),l(43,"Guardar"),o()()()()()),e&2){let i;d(),_(n.loading()?1:-1),d(4),v("formGroup",n.editForm),d(14),B("",n.editForm.value.description.length,"/500"),d(6),_(n.selectedVariant?25:26),d(3),_(n.openProdOption?28:-1),d(7),_((i=n.editForm.get("image"))!=null&&i.value?35:-1),d(3),v("routerLink","/dashboard/promotions"),d(3),v("disabled",!n.valid())}},dependencies:[Q,ne,X,W,J,K,ee,Y,Z,V,q],styles:[".main[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px;position:relative}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding-inline:32px}h1[_ngcontent-%COMP%]{color:var(--Gray-900, #181D27);font-family:var(--montser-font);font-size:30px;font-style:normal;font-weight:600;line-height:38px;margin:0}.form-text[_ngcontent-%COMP%]{display:flex;gap:32px;position:relative;margin-bottom:20px}.form-text[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:360px;color:var(--Gray-700, #414651);font-family:var(--montser-font);font-size:14px;font-style:normal;font-weight:600;line-height:20px}.input-base[_ngcontent-%COMP%]{width:512px;box-sizing:border-box}.create-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;padding-inline:32px}textarea[_ngcontent-%COMP%]{field-sizing:content;resize:none}.line[_ngcontent-%COMP%]{position:absolute;width:100%;bottom:-20px;height:1px;align-self:stretch;background:var(--Gray-200, #E9EAEB)}.count[_ngcontent-%COMP%]{color:var(--Gray-600, #535862);font-family:var(--montser-font);font-size:14px;font-style:normal;font-weight:400;line-height:20px}.input-base[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .input-base[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;flex:1;color:var(--Gray-500, #717680);font-family:var(--montser-font);font-size:16px;font-style:normal;font-weight:400;line-height:24px}.disc-btn[_ngcontent-%COMP%]{display:flex;padding:10px;cursor:pointer}.disc-btn[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{cursor:pointer}.discount[_ngcontent-%COMP%]{display:flex;width:170px;border-radius:8px;border:1px solid var(--Gray-300, #D5D7DA);background:var(--White, #FFF);overflow:hidden}.discount-txt[_ngcontent-%COMP%]{display:flex;padding:10px;flex:1;align-items:center;gap:10px;background:var(--Gray-50, #FAFAFA);border-inline:1px solid #D5D7DA}.discount-txt[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--Gray-800, #252B37);font-family:var(--montser-font);font-size:14px;font-style:normal;font-weight:500;line-height:20px}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{background-color:#fafafa;text-align:right;width:40px}input[type=date][_ngcontent-%COMP%]{opacity:0;position:absolute;pointer-events:none}.input-base[_ngcontent-%COMP%]{position:relative}.image[_ngcontent-%COMP%]{position:relative;height:40px;aspect-ratio:1;overflow:hidden}.image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;justify-self:center}.dialog.products[_ngcontent-%COMP%]{overflow:auto;max-height:600px}.input-base.propierty[_ngcontent-%COMP%]{border-color:#279ea8}.finish-data[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;flex:1}.finish-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--Gray-700, #414651);font-family:var(--montser-font);font-size:14px;font-style:normal;font-weight:500;line-height:20px}.avatar[_ngcontent-%COMP%]{display:flex;width:28px;height:28px;flex-direction:column;justify-content:center;align-items:center;border-radius:50%;overflow:hidden}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.selection[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form-footer[_ngcontent-%COMP%]{display:flex;justify-content:end;gap:12px}.delete[_ngcontent-%COMP%]{cursor:pointer}.data[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.discount[_ngcontent-%COMP%]{background-color:#fef3f2;color:#b42318;font-family:var(--montser-font);border:initial;display:flex;width:fit-content;padding-inline:8px;justify-content:center}.dialog-item[_ngcontent-%COMP%]{align-items:start;border-top:.5px solid lightgray}.dialog-item[_ngcontent-%COMP%]:hover{cursor:pointer}.image-container[_ngcontent-%COMP%]{display:flex;width:512px;flex-direction:column;align-items:flex-start;gap:16px}.banner-prev[_ngcontent-%COMP%]{display:flex;width:512px;height:199.111px;flex-direction:column;align-items:flex-start;gap:3.556px;overflow:hidden}.banner-prev[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}"]})};export{re as EditBanner};
